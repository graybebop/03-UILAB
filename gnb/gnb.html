<!DOCTYPE html>
<html lang="kr">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>GNB 모음</title>
    <!-- Font -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <!-- Noto Sans koran -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../css/swiper.css">
    <link rel="stylesheet" type="text/css" href="../css/styles.min.css">

    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/swiper.min.js"></script>
    <script src="../js/common.js"></script>
</head>


<body class="tpod-wrapper">

    <div class="tpod-container mt-30">
        <div class="tpod-row">
            <h4 class="ft-30 ft-700 text-black">
                GNB 기본형
            </h4>
        </div>
        <div class="" id="gnb-1">
            <nav>
                <ul class="gnb" id="gnb">
                    <li><a href="#none">메인메뉴</a>
                        <ul>
                            <li><a href="#none">서브메뉴</a></li>
                            <li><a href="#none">서브메뉴</a></li>
                            <li><a href="#none">서브메뉴</a></li>

                        </ul>
                    </li>
                    <li><a href="#none">메인메뉴</a>
                        <ul>
                            <li><a href="#none">서브메뉴</a></li>
                            <li><a href="#none">서브메뉴</a></li>
                            <li><a href="#none">서브메뉴</a></li>

                        </ul>
                    </li>
                    <li><a href="#none">메인메뉴</a>
                        <ul>
                            <li><a href="#none">서브메뉴</a></li>
                            <li><a href="#none">서브메뉴</a></li>
                            <li><a href="#none">서브메뉴</a></li>

                        </ul>
                    </li>
                    <li><a href="#none">메인메뉴</a>
                        <ul>
                            <li><a href="#none">서브메뉴</a></li>
                            <li><a href="#none">서브메뉴</a></li>
                            <li><a href="#none">서브메뉴</a></li>

                        </ul>
                    </li>
                    <li><a href="#none">메인메뉴</a>
                        <ul>
                            <li><a href="#none">서브메뉴</a></li>
                            <li><a href="#none">서브메뉴</a></li>
                            <li><a href="#none">서브메뉴</a></li>

                        </ul>
                    </li>
                    <li><a href="#none">메인메뉴</a>
                        <ul>
                            <li><a href="#none">서브메뉴</a></li>
                            <li><a href="#none">서브메뉴</a></li>
                            <li><a href="#none">서브메뉴</a></li>

                        </ul>
                    </li>
                    <li><a href="#none">메인메뉴</a>
                        <ul>
                            <li><a href="#none">서브메뉴</a></li>
                            <li><a href="#none">서브메뉴</a></li>
                            <li><a href="#none">서브메뉴</a></li>

                        </ul>
                    </li>

                </ul>
            </nav>
        </div>
    </div>
    <script>
        const MenuList = {

            setMenu: function() {

                this.depth = []; //각 1개의 메뉴를 배열에 저장

                this.gnb = document.getElementById("gnb");

                console.log(this.gnb)
                this.mainMenu = this.gnb.children; //1단계  li 만 기져온다.

                this.subUL = []; //각 메인메뉴의 서브메뉴를 담기위한 배열
                this.subLI = this.gnb.querySelectorAll('li'); //All Li
                this.link = this.gnb.querySelectorAll('#gnb li a'); //All link
                this.spanMenu = [];
                var _this = this;


                //1단계 각 메뉴를 init한다
                //각 li 밑에 ul의 단계를 체크한다.
                // ul of Depth+1, ul of depth+2,...... ul of Depth+N 만든 후 각 ul의 length를 구한후 저장한다.
                for (let i = 0; i < this.mainMenu.length; i++) {

                    this.mainMenu[i].setAttribute('data-depth', 1);
                    this.subUL.push(this.mainMenu[i].querySelectorAll('ul'));

                    this.subUL[i].forEach(function(sub, key) {
                        let eachUL = [];
                        eachUL[key] = sub;
                        eachUL[key].parentNode.setAttribute('class', 'has-children');
                        eachUL[key].parentNode.firstChild.classList.add('arrow-right');
                        // eachUL[key].parentNode.firstChild.setAttribute('data-depth', key + 1);


                        if (eachUL[key].localName == "ul") {
                            eachUL[key].setAttribute('class', 'depth-' + (key + 2));
                        }

                        if (key == 0) {

                            for (let j = 0; j < eachUL[key].children.length; j++) {

                                eachUL[key].children[j].setAttribute('data-depth', key + 2);

                                //eachUL[key].childNodes[j].firstChild.innerHTML = (key + 2) + ' 차메뉴';

                            }
                        }
                        if (key == 1) {
                            for (let j = 0; j < eachUL[key].childNodes.length; j++) {
                                eachUL[key].childNodes[j].setAttribute('data-depth', key + 2);
                                eachUL[key].childNodes[j].firstChild.innerHTML = (key + 2) + ' 차메뉴';
                            }
                        }

                    });
                }

                for (let i = 0; i < this.link.length; i++) {

                    this.spanMenu[i] = document.createElement('span');
                    this.spanMenu[i].setAttribute('class', 'material-icons-outlined');
                    this.spanMenu[i].innerHTML = "menu";
                    //insertBefore 용법(새로만들어질 엘리먼트, 어디에 붙일까????)
                    this.link[i].insertBefore(this.spanMenu[i], this.link[i].firstChild);
                    //arrow-right 클래스가 있는지 체크
                    if (this.link[i].classList.contains('arrow-right')) {
                        this.spanMenu[i].classList.add('mn-plus');
                    }
                }

                //모든 LI에 mouseover 이벤트를 만든다.
                this.subLI.forEach(function(lis, key) {
                    let eachLI = [];
                    eachLI[key] = lis;

                    eachLI[key].addEventListener('mouseover', function(e) {
                        console.log('시바뭐니', e.currentTarget)
                        _this.mouseEventHandler(e);
                    }.bind(this), false);

                    eachLI[key].addEventListener('mouseout', function(e) {
                        _this.mouseEventHandler(e);
                    }.bind(this), false);
                });
                //open all
                this.openAllMenu(true);

            },
            openAllMenu: function(state) {
                this.openAll(this.subLI, this.openState = state);
            },
            openAll: function(node, openState) {

                if (openState == true) {
                    for (let items of node) {
                        if (items.classList.contains('has-children')) {
                            let spanEle = items.childNodes[0].querySelector('span');
                            //console.log(items.childNodes)
                            spanEle.classList.add('active'); //가장상위 메뉴를 찾아서 active 클래스를 붙인다. 나중에 메뉴 인식시 필요함
                            spanEle.classList.remove('mn-plus');
                            spanEle.classList.add('mn-minus');
                            items.childNodes[0].classList.add('show');
                        }
                    }
                } else {
                    for (let items of node) {
                        if (items.classList.contains('has-children')) {
                            let spanEle = items.childNodes[0].querySelector('span');
                            //console.log(items.childNodes)
                            spanEle.classList.remove('active'); //가장상위 메뉴를 찾아서 active 클래스를 붙인다. 나중에 메뉴 인식시 필요함
                            spanEle.classList.add('mn-plus');
                            spanEle.classList.remove('mn-minus');
                            items.childNodes[0].classList.remove('show');
                        }
                    }
                }
            },
            openSubMenu: function(node) {

                if (node[0].parentNode.classList.contains('has-children')) {
                    var spanEle = node[0].querySelector('span');
                    node[0].classList.add('active'); //가장상위 메뉴를 찾아서 active 클래스를 붙인다. 나중에 메뉴 인식시 필요함
                    spanEle.classList.remove('mn-plus');
                    spanEle.classList.add('mn-minus');
                    node.forEach(function(sub, key, parent) {
                        if (parent[key].localName == "ul") {
                            parent[key].classList.add('show');

                        } else {
                            if (node[0].parentNode.classList.contains('has-children') && spanEle.classList.contains('mn-minus')) {
                                return false;
                            }
                        }

                    });
                }
            },

            hideSubMenu: function(node) {
                if (node[0].parentNode.classList.contains('has-children')) {
                    var spanEle = node[0].querySelector('span');
                    node[0].classList.remove('active'); //가장상위 메뉴를 찾아서 active 클래스를 붙인다. 나중에 메뉴 인식시 필요함
                    spanEle.classList.add('mn-plus');
                    spanEle.classList.remove('mn-minus');
                    node.forEach(function(sub, key, parent) {
                        if (parent[key].localName == "ul") {
                            parent[key].classList.remove('show');
                        } else {
                            if (node[0].parentNode.classList.contains('has-children') && spanEle.classList.contains('mn-minus')) {
                                return false;
                            }
                        }

                    });
                }

            },

            mouseEventHandler: function(e) {
                const mn = e.currentTarget; //1단계메뉴 li
                //ul li의 중첩클릭방지
                e.cancelBubble = true;
                e.stopImmediatePropagation = true;

                switch (e.type) {
                    case 'mouseover':
                        this.openSubMenu(mn.childNodes);
                        break;

                    case 'mouseout':
                        this.hideSubMenu(mn.childNodes);
                        break;

                }

            },
            getMenuLength: function() {
                for (var key1 in this.items) {
                    console.log(this.items[key1].MainMenuName);
                    if (this.items[key1].secondDepth) {
                        this.sd = this.items[key1].secondDepth.length;
                        //console.log(this.sd);
                        //console.log('this.items[key1].secondDepth.length : ', this.items[key1].secondDepth.length)
                        for (var key2 in this.items[key1].secondDepth) {
                            // console.log(this.items[key1].secondDepth[key2].name);

                            if (this.items[key1].secondDepth[key2].thirdDepth) {

                                //console.log('this.items[key1].secondDepth[key2].thirdDepth : ', this.items[key1].secondDepth[key2].thirdDepth.length)

                                this.td = this.items[key1].secondDepth[key2].thirdDepth.length;
                                for (var key3 in this.items[key1].secondDepth[key2].thirdDepth.length) {
                                    console.log('씨바3차 : ', this.items[key1].secondDepth[key2].thirdDepth[key3].name);
                                }
                            }
                        }
                    }

                }
            },




        }

        MenuList.setMenu();
    </script>
    <style>
        .show {
            display: block !important;
        }
        
        .hide {
            display: none !important;
        }
    </style>

</body>

</html>