<?php
    $servername = "localhost";
    $username = "saigonvue";
    $password = "sdk8*2jsk!2jajA";
    $db = "saigonvue";
    $conn = new mysqli($servername, $username, $password, $db);
    //$conn = new mysqli("localhost","my_user","my_password","my_db");
	
	$movie = [];
	
	if ($conn -> connect_errno) {
	  echo "Failed to connect to MySQL: " . $conn -> connect_error;
	  exit();
	}

	$sql = "SELECT * from images";
	$result = mysqli_query( $conn, $sql);
	
	$response = $result->fetch_all(MYSQLI_ASSOC);
	while ($obj = mysqli_fetch_object($result)) {
		
		$row['id'] = mb_convert_encoding($obj['id'], "UTF-8", "auto");
        $row['file_name'] = mb_convert_encoding($obj['file_name'], "UTF-8", "auto");
        
       
		array_push($response, $row);
		//$movie[] = $obj;
		//echo var_dump($obj);
	}
	
	 $json = json_encode($response, JSON_UNESCAPED_UNICODE);
	//echo $json;
	 
	
	$conn -> close();
    
   
?>

    <!DOCTYPE html>
    <html lang="kr">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <title>TPOD</title>

        <!-- Font -->
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <!-- Noto Sans koran -->
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="css/swiper.css">
        <link rel="stylesheet" type="text/css" href="css/styles.min.css">

        <script src="js/jquery-3.3.1.min.js"></script>
        <script src="js/swiper.min.js"></script>
        <script src="js/common.js"></script>
    </head>
    <style>
        .wrapper {
            padding: 10px 20px;
            position: relative;
        }
        
        .grid-list {
            border: 0px solid #ddd;
        }
        
        .grid-list .items {
            margin: 5px 10px 15px 10px;
            padding-bottom: 10px;
            align-self: auto;
            height: auto;
        }
        
        #calc {
            z-index: 10;
            position: fixed;
            bottom: 10px;
            padding: 10px;
            border: 1px solid #000;
            background-color: #fff;
        }
        
        .history-back {
            position: fixed;
            width: 100%;
            height: 50px;
            z-index: 10;
            background-color: #fff;
            padding-left: 10px;
            padding-top: 20px;
        }
        
        .t-card {
            height: auto !important;
        }
        
        @media(max-width:760px) {
            .wrapper {
                padding: 10px;
            }
        }
        
        .t-card__subtitle {
            margin-top: 10px !important;
        }
        
        .top-button-area {
            position: absolute;
            top: 30px;
            right: 30px;
        }
        
        .top-button-area .material-icons-outlined {
            font-size: 18px;
        }
        
        @media(max-width:760px) {
            .top-button-area {
                position: relative;
            }
        }
    </style>

    <body>
        <!-- <div class="history-back">
        <button class="btn btn-circle btn-sm" onclick="ui.goback()">
            <span class="material-icons">
                arrow_back
            </span>
        </button>
        <span style="vertical-align: middle;">이전페이지로</span>
    </div> -->
        <section class="wrapper">
            <div class="top-button-area">
                <button class="btn btn-sm btn-light btn-outlined"><span class="material-icons-outlined">
                format_list_bulleted
                </span>리스트</button>
                <button class="btn btn-sm btn-secondary"><span class="material-icons-outlined">
                apps
                    </span>그리드</button>
            </div>
            <h5 class="pt-50 pb-20">전체리스트 - <span class="font-size-14 font-weight-300">총 <em id="articleNo" class="font-weight-700">34</em> 개의 작업물이 완료되었습니다.</span></h5>

            <ul class="grid-list" id="grid">
                <!-- <li data-link="/portfolio/" class="t-card items"> -->
                <!-- <div class="t-card_thumb" style="background-image: url('uilab/1.jpg');"> -->
                <!-- </div> -->
                <!-- <div class="t-card__title">이력리스트(VUE JS & PHP & MYSQL)</div> -->
                <!-- <div class="t-card__subtitle">2000년도 부터 지금까지 일한 작업내역</div> -->
                <!-- </li> -->

            </ul>

        </section>


        <script>
            var imageData = <?php echo $json; ?>

            function showData(obj) {
                let sliderEle = document.getElementById('grid');
                let index = 0;
                let kkk = new Array();

                console.log(obj)

                for (let value in obj) {

                    let lis = document.createElement('li');
                    sliderEle.appendChild(lis);
                    lis.innerHTML += "<div class='t-card_thumb'><img src='" + obj[index].file_name + "'/></div>";

                    lis.innerHTML += "<div class='" + "t-card__title" + "'>" + obj[index].id + "</div>";
                    lis.innerHTML += "<div class='" + "t-card__subtitle" + "'>" + obj[index].subTitle + "</div>";
                    lis.setAttribute('data-link', obj[index].link);
                    lis.setAttribute('class', 't-card items');

                    //var style = lis.currentStyle || window.getComputedStyle(lis);
                    //var lisMarginRight = parseInt(style.marginRight); //px 값을 제거하고 margin right 값을 반환

                    //lis.setAttribute('style', 'width:' + String(slideItemWidth - marginRight) + 'px !important; margin-right:' + marginRight + 'px;');


                    kkk[index] = obj[index].file_name.split('|');
                    //console.log(kkk[0]);

                    for (let v in kkk) {

                        console.log(kkk[v]);

                    }

                    index++;

                }
            }


            showData(imageData);

            const gridList = {

                init: function() {

                    this.items = document.querySelectorAll('.grid-list .items'); //현재 정보
                    this.container = document.getElementsByClassName('grid-list')[0];
                    this.container_flex_width = document.getElementsByClassName('grid-list')[0].clientWidth;

                    this.delay = 250;
                    this.timer = null;
                    this.count = 10;

                    window.addEventListener('resize', () => {
                        this.resizeHandler();
                    });

                    this.resizeHandler();
                },

                reArrange: function(ttt, width) {
                    let length = ttt.length;
                    for (var i = 0; i < length; i++) {
                        ttt[i].style.width = width + 'px';
                    }
                },

                resizeHandler: function() {

                    var w_w_width = window.innerWidth;
                    this.breakPoint = {
                        'col-xss': 350,
                        'col-xs': 450,
                        'col-sm': 760,
                        'col-md': 1024,
                        'col-lg': 1500,
                        'col-xl': 1650,
                    };
                    if (this.breakPoint['col-xss'] <= w_w_width && this.breakPoint['col-xs'] >= w_w_width) {
                        this.itemsCol = 1;
                    }
                    if (this.breakPoint['col-xs'] <= w_w_width && this.breakPoint['col-sm'] >= w_w_width) {
                        this.itemsCol = 2;
                    }

                    if (this.breakPoint['col-sm'] <= w_w_width && this.breakPoint['col-md'] >= w_w_width) {
                        this.itemsCol = 2;
                    }
                    if (this.breakPoint['col-md'] <= w_w_width && this.breakPoint['col-lg'] >= w_w_width) { //1024보다 크고  1170보다 작음
                        this.itemsCol = 3;

                    }
                    if (this.breakPoint['col-lg'] <= w_w_width && this.breakPoint['col-xl'] >= w_w_width) {
                        this.itemsCol = 4;
                    }
                    if (this.breakPoint['col-xl'] < w_w_width) {
                        this.itemsCol = 5;
                    }

                    clearTimeout(this.timer);

                    this.timer = setTimeout(() => {
                        this.getItems(this.itemsCol);

                        console.log('itemsCol', this.itemsCol, this)

                    }, this.delay);


                    console.log(this.itemsCol)
                },
                getItems: function(n) {

                    let itemsProps = window.getComputedStyle(document.getElementsByClassName('items')[0]);

                    let itemsPadRight = parseInt(itemsProps.paddingRight);
                    let itemsPadLeft = parseInt(itemsProps.paddingLeft);
                    let itemsMarginRight = parseInt(itemsProps.marginRight);
                    let itemsMarginLeft = parseInt(itemsProps.marginLeft);

                    this.container.style.marginLeft = -itemsMarginLeft + 'px';
                    this.container.style.marginRight = -itemsMarginRight + 'px';

                    let border = n * 2;
                    this.itemsCol = n;
                    let itemsRow = 100 / this.itemsCol;
                    let itemsTotal = itemsPadRight + itemsPadLeft + itemsMarginRight + itemsMarginLeft + border;

                    let itemsSpace = 'calc(' + itemsRow + '% - ' + itemsTotal + 'px )';
                    let i = 0;


                    let rowWidth = 0;
                    let itemsWidth = [];

                    let lastWidth = null;

                    for (var item of this.items) {

                        item.style.width = itemsSpace;
                        if (i < n) {
                            itemsWidth[i] = item.clientWidth;
                            rowWidth = rowWidth + itemsWidth[i];
                            if (i == n - 1) {

                                lastWidth = (rowWidth / n) + (border - 2);
                            }
                            i++;
                        }

                        this.reArrange(this.items, lastWidth);
                    }


                }
            }

            window.addEventListener('load', () => {
                gridList.init();
                ui.gotoUrl();

                let txtwrap = document.querySelectorAll('.grid-list li');
                document.getElementById('articleNo').innerText = txtwrap.length;
            })
        </script>



    </body>

    </html>